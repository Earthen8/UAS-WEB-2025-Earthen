{% extends 'base.html' %}

{% block content %}
<div class="bg-white/95 backdrop-blur-xl rounded-xl shadow-2xl border border-white/20 text-gray-800 relative z-10 max-w-[400px] mx-auto">
    
    <div class="h-10 bg-gray-100/90 border-b border-gray-200 flex items-center px-4 justify-between rounded-t-xl z-20 relative">
      <div class="flex items-center gap-4">
          <div class="flex gap-2">
              <div class="w-3 h-3 rounded-full bg-red-500 border border-red-600"></div>
              <div class="w-3 h-3 rounded-full bg-yellow-400 border border-yellow-500"></div>
              <div class="w-3 h-3 rounded-full bg-green-500 border border-green-600"></div>
          </div>
          
          <div class="h-4 w-px bg-gray-300"></div>

          <div class="text-gray-300 cursor-not-allowed p-1">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
              </svg>
          </div>
      </div>
      
      <div class="text-xs font-semibold text-gray-400 absolute left-1/2 transform -translate-x-1/2">
          SkyTravel
      </div>
    </div>

    <div class="p-8">
        <h1 class="text-2xl font-semibold mb-8 text-center tracking-tight text-gray-900">SEARCH FLIGHT</h1>

        <form action="{% url 'flight_result' %}" method="GET" class="space-y-4">
            
            <div class="relative group z-30">
                <div class="flex gap-2">
                    <input type="text" name="origin" id="originInput" placeholder="Departure City" required maxlength="3"
                        oninput="validateCode(this)" autocomplete="off"
                        class="flex-1 p-3 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm placeholder-gray-500 transition">
                    
                    <button type="button" onclick="toggleDropdown('originList')" 
                            class="w-10 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 text-gray-600 flex items-center justify-center transition shadow-sm active:bg-gray-300 cursor-pointer">
                        ▼
                    </button>
                </div>
                
                <div id="originList" 
                  class="hidden absolute top-12 right-0 w-64 bg-white/95 backdrop-blur-md border border-gray-200 rounded-lg shadow-2xl p-2 max-h-80 overflow-y-auto transform transition-all">

                  <div class="text-xs font-bold text-gray-400 px-2 py-1">ASIA PACIFIC</div>
                  <div onclick="selectCity('origin', 'CGK')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm transition-colors">Jakarta (CGK)</div>
                  <div onclick="selectCity('origin', 'DPS')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm transition-colors">Bali (DPS)</div>
                  <div onclick="selectCity('origin', 'SIN')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm transition-colors">Singapore (SIN)</div>
                  <div onclick="selectCity('origin', 'HND')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm transition-colors">Tokyo (HND)</div>
                  <div onclick="selectCity('origin', 'KUL')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm transition-colors">Kuala Lumpur (KUL)</div>
                  <div onclick="selectCity('origin', 'BKK')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm transition-colors">Bangkok (BKK)</div>

                  <div class="text-xs font-bold text-gray-400 px-2 py-1 mt-2">INTERNATIONAL</div>
                  <div onclick="selectCity('origin', 'LHR')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm transition-colors">London (LHR)</div>
                  <div onclick="selectCity('origin', 'AMS')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm transition-colors">Amsterdam (AMS)</div>
                  <div onclick="selectCity('origin', 'JFK')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm transition-colors">New York (JFK)</div>
                  <div onclick="selectCity('origin', 'DXB')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm transition-colors">Dubai (DXB)</div>
                  <div onclick="selectCity('origin', 'LAX')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm transition-colors">Los Angeles (LAX)</div>
              </div>

            </div>

            <div class="relative group z-20">
                <div class="flex gap-2">
                    <input type="text" name="destination" id="destInput" placeholder="Arrival City" required maxlength="3"
                        oninput="validateCode(this)" autocomplete="off"
                        class="flex-1 p-3 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm placeholder-gray-500 transition">
                    
                    <button type="button" onclick="toggleDropdown('destList')" 
                            class="w-10 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 text-gray-600 flex items-center justify-center transition shadow-sm active:bg-gray-300 cursor-pointer">
                        ▼
                    </button>
                </div>

                <div id="destList" 
                    class="hidden absolute top-12 right-0 w-64 bg-white/90 backdrop-blur-md border border-gray-200 rounded-lg shadow-xl z-50 p-2 max-h-80 overflow-y-auto">

                    <div class="text-xs font-bold text-gray-400 px-2 py-1">ASIA PACIFIC</div>
                    <div onclick="selectCity('dest', 'CGK')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm">Jakarta (CGK)</div>
                    <div onclick="selectCity('dest', 'DPS')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm">Bali (DPS)</div>
                    <div onclick="selectCity('dest', 'SIN')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm">Singapore (SIN)</div>
                    <div onclick="selectCity('dest', 'HND')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm">Tokyo (HND)</div>
                    <div onclick="selectCity('dest', 'KUL')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm">Kuala Lumpur (KUL)</div>
                    <div onclick="selectCity('dest', 'BKK')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm">Bangkok (BKK)</div>

                    <div class="text-xs font-bold text-gray-400 px-2 py-1 mt-2">INTERNATIONAL</div>
                    <div onclick="selectCity('dest', 'LHR')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm">London (LHR)</div>
                    <div onclick="selectCity('dest', 'AMS')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm">Amsterdam (AMS)</div>
                    <div onclick="selectCity('dest', 'JFK')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm">New York (JFK)</div>
                    <div onclick="selectCity('dest', 'DXB')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm">Dubai (DXB)</div>
                    <div onclick="selectCity('dest', 'LAX')" class="cursor-pointer px-3 py-2 hover:bg-blue-500 hover:text-white rounded text-sm">Los Angeles (LAX)</div>

                </div>

            </div>

            <style>
                input[type="date"]::-webkit-calendar-picker-indicator,
                input[type="date"]::-webkit-inner-spin-button {
                    display: none;
                    -webkit-appearance: none;
                }
            </style>

            <div class="relative z-10">
                <input type="text" name="date" id="depDate" required placeholder="Departure Date"
                    onfocus="(this.type='date');this.showPicker()"
                    onblur="if(!this.value)this.type='text'"
                    class="w-full p-3 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm text-gray-600 font-sans">
            </div>

            <div class="relative z-0">
                <input type="text" name="return_date" id="returnDate" placeholder="Arrival Date" disabled
                    onfocus="(this.type='date');this.showPicker()"
                    onblur="if(!this.value)this.type='text'"
                    class="w-full p-3 bg-gray-100 border border-gray-300 rounded-md shadow-inner text-sm text-gray-400 cursor-not-allowed">
                
                <label class="absolute right-3 top-3 flex items-center space-x-2 text-xs cursor-pointer">
                    <input type="checkbox" id="roundTripCheck" class="accent-blue-500">
                    <span class="text-gray-500">Round Trip</span>
                </label>
            </div>

            <button type="submit" class="w-full mt-6 bg-gray-700 hover:bg-gray-800 text-white font-medium py-3 rounded-md shadow-md active:scale-[0.98] transition-transform">
                Search
            </button>
        </form>
    </div>
</div>

{% block scripts %}
<script>
    function toggleDropdown(id) {
        const target = document.getElementById(id);
        const allDropdowns = ['originList', 'destList'];
        
        allDropdowns.forEach(dropdownId => {
            if (dropdownId !== id) {
                const el = document.getElementById(dropdownId);
                if(el) el.classList.add('hidden');
            }
        });

        if (target) {
            target.classList.toggle('hidden');
        }
    }

    function selectCity(type, code) {
        const input = type === 'origin' ? document.getElementById('originInput') : document.getElementById('destInput');
        const list = type === 'origin' ? document.getElementById('originList') : document.getElementById('destList');
        
        if(input) input.value = code;
        if(list) list.classList.add('hidden'); 
    }

    document.addEventListener('click', function(event) {
        const isClickInside = event.target.closest('.group');
        if (!isClickInside) {
            const originList = document.getElementById('originList');
            const destList = document.getElementById('destList');
            if(originList) originList.classList.add('hidden');
            if(destList) destList.classList.add('hidden');
        }
    });

    function validateCode(input) {
        input.value = input.value.replace(/[^a-zA-Z]/g, '').toUpperCase();
    }

    const depInput = document.getElementById('depDate');
    const returnInput = document.getElementById('returnDate');
    const roundTripCheck = document.getElementById('roundTripCheck');

    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1); 

    const todayStr = today.toISOString().split('T')[0];
    const tomorrowStr = tomorrow.toISOString().split('T')[0];
    
    if(depInput) depInput.setAttribute('min', todayStr);

    if(depInput) {
        depInput.addEventListener('change', function() {
            if(this.value && roundTripCheck.checked) {
                const selectedDep = new Date(this.value);
                selectedDep.setDate(selectedDep.getDate() + 1); 
                
                const minReturn = selectedDep.toISOString().split('T')[0];
                returnInput.setAttribute('min', minReturn);

                if(returnInput.value && returnInput.value < minReturn) {
                    returnInput.value = ''; 
                }
            }
        });
    }

    if(roundTripCheck) {
        roundTripCheck.addEventListener('change', function() {
            if(this.checked) {
                returnInput.disabled = false;
                returnInput.classList.remove('bg-gray-100', 'cursor-not-allowed', 'text-gray-400');
                returnInput.classList.add('bg-white', 'text-gray-800');

                let minDate = tomorrowStr;

                if(depInput.value) {
                    const depDate = new Date(depInput.value);
                    depDate.setDate(depDate.getDate() + 1);
                    
                    if(depDate > tomorrow) {
                        minDate = depDate.toISOString().split('T')[0];
                    }
                }
                
                returnInput.setAttribute('min', minDate);

            } else {
                returnInput.disabled = true;
                returnInput.value = '';
                returnInput.classList.add('bg-gray-100', 'cursor-not-allowed', 'text-gray-400');
                returnInput.classList.remove('bg-white', 'text-gray-800');
            }
        });
    }
</script>
{% endblock %}
{% endblock %}